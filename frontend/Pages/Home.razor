@page "/home"
@using Microsoft.AspNetCore.Authorization
@using Microsoft.AspNetCore.Components.Authorization
@using MudBlazor
@using frontend.Models
@using ToolsSharing.Frontend.Models
@using frontend.Services
@using ToolsSharing.Frontend.Services
@using frontend.Components.Bundles
@using frontend.Components.Tools
@inject IToolService ToolService
@inject BundleService BundleService
@inject NavigationManager Navigation
@inject IUrlService UrlService
@attribute [AllowAnonymous]

<PageTitle>NeighborTools - Share and Borrow Tools</PageTitle>

<!-- Modern Login/Register Banner for Non-Logged-In Users -->
<AuthorizeView>
    <NotAuthorized>
        <MudPaper Elevation="0" Class="pa-8 mb-8 animate-fade-in-up" Style="background: var(--mud-gradient-hero); border-radius: var(--mud-radius-2xl); box-shadow: var(--mud-shadow-lg);">
            <div class="d-flex flex-column align-center text-center">
                <MudIcon Icon="@Icons.Material.Filled.Handyman" Size="Size.Large" Class="animate-float" Style="font-size: 4rem; color: white; margin-bottom: var(--mud-spacing-lg);" />
                <MudText Typo="Typo.h3" Style="color: white; font-weight: var(--mud-font-weight-bold); font-family: var(--mud-font-family-sans); line-height: var(--mud-line-height-tight);" GutterBottom="true">
                    Join NeighborTools Today
                </MudText>
                <MudText Typo="Typo.h6" Style="color: rgba(255,255,255,0.9); max-width: 700px; margin-bottom: var(--mud-spacing-xl); font-family: var(--mud-font-family-sans); line-height: var(--mud-line-height-relaxed);">
                    Start sharing and borrowing tools with your neighbors. Build stronger communities while saving money.
                </MudText>
                
                <!-- Benefits Grid -->
                <MudGrid Class="mb-6" Style="max-width: 800px;">
                    <MudItem xs="12" sm="4">
                        <div class="d-flex flex-column align-center">
                            <MudIcon Icon="@Icons.Material.Filled.AttachMoney" Style="color: rgba(255,255,255,0.9); font-size: 2rem; margin-bottom: var(--mud-spacing-sm);" />
                            <MudText Typo="Typo.subtitle1" Style="color: white; font-weight: var(--mud-font-weight-semibold); font-family: var(--mud-font-family-sans);">Save Money</MudText>
                            <MudText Typo="Typo.caption" Style="color: rgba(255,255,255,0.8); font-family: var(--mud-font-family-sans); text-align: center;">
                                Rent tools instead of buying them
                            </MudText>
                        </div>
                    </MudItem>
                    <MudItem xs="12" sm="4">
                        <div class="d-flex flex-column align-center">
                            <MudIcon Icon="@Icons.Material.Filled.People" Style="color: rgba(255,255,255,0.9); font-size: 2rem; margin-bottom: var(--mud-spacing-sm);" />
                            <MudText Typo="Typo.subtitle1" Style="color: white; font-weight: var(--mud-font-weight-semibold); font-family: var(--mud-font-family-sans);">Build Community</MudText>
                            <MudText Typo="Typo.caption" Style="color: rgba(255,255,255,0.8); font-family: var(--mud-font-family-sans); text-align: center;">
                                Connect with your neighbors
                            </MudText>
                        </div>
                    </MudItem>
                    <MudItem xs="12" sm="4">
                        <div class="d-flex flex-column align-center">
                            <MudIcon Icon="@Icons.Material.Filled.Recycling" Style="color: rgba(255,255,255,0.9); font-size: 2rem; margin-bottom: var(--mud-spacing-sm);" />
                            <MudText Typo="Typo.subtitle1" Style="color: white; font-weight: var(--mud-font-weight-semibold); font-family: var(--mud-font-family-sans);">Go Green</MudText>
                            <MudText Typo="Typo.caption" Style="color: rgba(255,255,255,0.8); font-family: var(--mud-font-family-sans); text-align: center;">
                                Reduce waste through sharing
                            </MudText>
                        </div>
                    </MudItem>
                </MudGrid>

                <!-- Action Buttons -->
                <div class="d-flex gap-4 flex-wrap justify-center">
                    <MudButton Variant="Variant.Filled"
                               Color="Color.Surface"
                               Size="Size.Large"
                               Href="/login"
                               StartIcon="@Icons.Material.Filled.Login"
                               Class="animate-glow"
                               Style="color: var(--mud-palette-primary); font-weight: var(--mud-font-weight-bold); font-family: var(--mud-font-family-sans); border-radius: var(--mud-radius-full); padding: var(--mud-spacing-lg) var(--mud-spacing-2xl);">
                        Sign In
                    </MudButton>
                    <MudButton Variant="Variant.Outlined"
                               Color="Color.Surface"
                               Size="Size.Large"
                               Href="/register"
                               StartIcon="@Icons.Material.Filled.PersonAdd"
                               Style="color: white; border-color: rgba(255,255,255,0.5); font-weight: var(--mud-font-weight-bold); font-family: var(--mud-font-family-sans); border-radius: var(--mud-radius-full); padding: var(--mud-spacing-lg) var(--mud-spacing-2xl);">
                        Get Started
                    </MudButton>
                </div>
            </div>
        </MudPaper>
    </NotAuthorized>
</AuthorizeView>

<!-- Modern Quick Actions -->
<MudGrid Class="mb-8">
    <MudItem xs="12" sm="6" md="4">
        <MudCard Elevation="0" Class="modern-card animate-fade-in-up animate-delay-100" Style="height: 100%;">
            <MudCardContent Class="d-flex flex-column align-center text-center pa-6">
                <MudIcon Icon="@Icons.Material.Filled.Add" Color="Color.Primary" Size="Size.Large" Class="mb-4 animate-pulse" Style="font-size: 3.5rem;" />
                <MudText Typo="Typo.h5" Color="Color.Primary" GutterBottom="true" Style="font-family: var(--mud-font-family-sans); font-weight: var(--mud-font-weight-semibold);">Share Your Tools</MudText>
                <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4" Style="font-family: var(--mud-font-family-sans); line-height: var(--mud-line-height-relaxed);">
                    List your tools and earn money by sharing them with neighbors.
                </MudText>
                <MudSpacer />
                <MudButton Variant="Variant.Filled" Color="Color.Primary" Href="/my-tools" StartIcon="@Icons.Material.Filled.Inventory" Style="border-radius: var(--mud-radius-full); font-family: var(--mud-font-family-sans); font-weight: var(--mud-font-weight-medium);">
                    My Tools
                </MudButton>
            </MudCardContent>
        </MudCard>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudCard Elevation="0" Class="modern-card animate-fade-in-up animate-delay-200" Style="height: 100%;">
            <MudCardContent Class="d-flex flex-column align-center text-center pa-6">
                <MudIcon Icon="@Icons.Material.Filled.Search" Color="Color.Success" Size="Size.Large" Class="mb-4 animate-pulse" Style="font-size: 3.5rem;" />
                <MudText Typo="Typo.h5" Color="Color.Success" GutterBottom="true" Style="font-family: var(--mud-font-family-sans); font-weight: var(--mud-font-weight-semibold);">Find Tools</MudText>
                <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4" Style="font-family: var(--mud-font-family-sans); line-height: var(--mud-line-height-relaxed);">
                    Browse and rent tools from your neighbors when you need them.
                </MudText>
                <MudSpacer />
                <MudButton Variant="Variant.Filled" Color="Color.Success" Href="/tools" StartIcon="@Icons.Material.Filled.Search" Style="border-radius: var(--mud-radius-full); font-family: var(--mud-font-family-sans); font-weight: var(--mud-font-weight-medium);">
                    Browse Tools
                </MudButton>
            </MudCardContent>
        </MudCard>
    </MudItem>
    
    <MudItem xs="12" sm="6" md="4">
        <MudCard Elevation="0" Class="modern-card animate-fade-in-up animate-delay-300" Style="height: 100%;">
            <MudCardContent Class="d-flex flex-column align-center text-center pa-6">
                <MudIcon Icon="@Icons.Material.Filled.Inventory" Color="Color.Info" Size="Size.Large" Class="mb-4 animate-pulse" Style="font-size: 3.5rem;" />
                <MudText Typo="Typo.h5" Color="Color.Info" GutterBottom="true" Style="font-family: var(--mud-font-family-sans); font-weight: var(--mud-font-weight-semibold);">Tool Bundles</MudText>
                <MudText Typo="Typo.body1" Color="Color.Secondary" Class="mb-4" Style="font-family: var(--mud-font-family-sans); line-height: var(--mud-line-height-relaxed);">
                    Discover curated tool collections for complete projects.
                </MudText>
                <MudSpacer />
                <MudButton Variant="Variant.Filled" Color="Color.Info" Href="/bundles" StartIcon="@Icons.Material.Filled.Inventory" Style="border-radius: var(--mud-radius-full); font-family: var(--mud-font-family-sans); font-weight: var(--mud-font-weight-medium);">
                    Browse Bundles
                </MudButton>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>

<!-- Featured Tools Section -->
<FeaturedToolsSection Count="6" ShowViewAllButton="true" />

<!-- Featured Bundles Section -->
@if (isLoadingBundles)
{
    <MudCard Class="ma-4 mt-8">
        <MudCardContent>
            <MudSkeleton Height="200px" />
            <MudSkeleton Height="40px" Class="mt-2" />
            <MudSkeleton Height="60px" Class="mt-2" />
        </MudCardContent>
    </MudCard>
}
else if (featuredBundles != null && featuredBundles.Any())
{
    <MudCard Class="ma-4 mt-8">
        <MudCardHeader>
            <CardHeaderContent>
                <MudText Typo="Typo.h5" Class="d-flex align-center">
                    <MudIcon Icon="@Icons.Material.Filled.Star" Color="Color.Warning" Class="mr-2" />
                    Featured Tool Bundles
                </MudText>
                <MudText Typo="Typo.body2" Class="text-muted">
                    Discover curated tool collections for complete projects
                </MudText>
            </CardHeaderContent>
        </MudCardHeader>
        
        <MudCardContent>
            <MudGrid>
                @foreach (var bundle in featuredBundles.Take(6))
                {
                    <MudItem xs="12" sm="6" md="4">
                        <BundleCard Bundle="bundle" OnClick="@(() => Navigation.NavigateTo($"/bundles/{bundle.Id}"))" />
                    </MudItem>
                }
            </MudGrid>
            
            <div class="text-center mt-4">
                <MudButton StartIcon="Icons.Material.Filled.ViewList" 
                          Color="Color.Secondary" 
                          Variant="Variant.Outlined"
                          Href="/bundles">
                    View All Bundles
                </MudButton>
            </div>
        </MudCardContent>
    </MudCard>
}

<style>
    .hover-card:hover {
        transform: translateY(-8px);
        box-shadow: var(--mud-shadow-xl);
        border-color: var(--mud-border-focus);
    }
</style>

@code {
    private List<BundleModel>? featuredBundles;
    private bool isLoadingBundles = true;

    protected override async Task OnInitializedAsync()
    {
        await LoadFeaturedBundles();
    }

    private async Task LoadFeaturedBundles()
    {
        isLoadingBundles = true;

        try
        {
            var result = await BundleService.GetFeaturedBundlesAsync(6);
            
            if (result.Success)
            {
                featuredBundles = result.Data;
            }
        }
        catch (Exception)
        {
            // Silently handle errors for featured bundles
        }
        finally
        {
            isLoadingBundles = false;
        }
    }
}
